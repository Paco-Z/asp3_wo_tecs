
		TOPPERS/ASP3カーネル
		Zynq7000依存部 ユーザーズマニュアル

		対応バージョン: Release 3.3.1
		最終更新: 2018年5月2日

このドキュメントは，TOPPERS/ASP3カーネルのZynq-7000ターゲット依存部を
使用するために必要な事項を説明するものである．

----------------------------------------------------------------------
 TOPPERS/ASP Kernel
     Toyohashi Open Platform for Embedded Real-Time Systems/
     Advanced Standard Profile Kernel

 Copyright (C) 2008-2018 by Embedded and Real-Time Systems Laboratory
             Graduate School of Information Science, Nagoya Univ., JAPAN
 
 上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
 ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
 変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
 (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
     権表示，この利用条件および下記の無保証規定が，そのままの形でソー
     スコード中に含まれていること．
 (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
     用できる形で再配布する場合には，再配布に伴うドキュメント（利用
     者マニュアルなど）に，上記の著作権表示，この利用条件および下記
     の無保証規定を掲載すること．
 (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
     用できない形で再配布する場合には，次のいずれかの条件を満たすこ
     と．
   (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
       作権表示，この利用条件および下記の無保証規定を掲載すること．
   (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
       報告すること．
 (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
     害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
     また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
     由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
     免責すること．
 
 本ソフトウェアは，無保証で提供されているものである．上記著作権者お
 よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
 に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
 アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
 の責任を負わない．
 
 $Id: target_user.txt 969 2018-05-02 09:32:30Z ertl-honda $
----------------------------------------------------------------------

○目次

１．Zynq7000ターゲット依存部の概要
	1.1 対応するターゲットシステムとターゲット略称
	1.2 ターゲット依存部の構成
	1.3 依存している個別パッケージのバージョン番号
	1.4 開発環境と動作確認条件
	1.5 メモリマップ
２．ターゲット定義事項の規定
	2.1 割込み優先度と割込み番号
	2.2 オーバランハンドラ機能拡張のサポートに関する規定
３．ドライバ関連の情報
	3.1 タイマドライバ
	3.2 シリアルインタフェースドライバ
	3.3 システムログの低レベル出力
４．システム構築手順と実行手順
	4.1 システム構築
	4.2 デバッガの使用方法
５．リファレンス
	5.1 ディレクトリ構成・ファイル構成
	5.2 バージョン履歴


１．Zynq-7000ターゲット依存部の概要

Zynq-7000ターゲット依存部は，TOPPERS/ASP3カーネルを，
Zynq-7000(Cortex-A9)を搭載したターゲットシステムで動作させる環境を構築
するためのものである．

1.1 対応するターゲットシステムとターゲット略称

Zynq-7000ターゲット依存部の動作確認は，以下のボードで行っている．

	Degilent Zybo
	Trenz Electronic ArduZynq

また，ターゲット略称等は次の通り．

	ターゲット略称：zynq7000_gcc
	システム略称：zynq7000
	開発環境略称：gcc

1.2 ターゲット依存部の構成

Zynq7000ターゲット依存部の使用するターゲット依存部（targetディレクト
リ）およびターゲット依存部の共通部（archディレクトリ）のディレクトリは
次の通り．

	target/
		zynq7000_gcc/		Zynq-7000ターゲット依存部

	arch/
		arm_gcc/common/		ARMコア依存部
		arm_gcc/mpcore/		MPCoreチップ依存部
		arm_gcc/doc/		ARM依存部に関するドキュメント
		gcc/				GCC開発環境依存部
		tracelog/			トレースログ記録のサンプルコード

1.3 依存している個別パッケージのバージョン番号

Zynq-7000ターゲット依存部（バージョン 3.3.1）の個別パッケージが依存し
ている個別パッケージと，動作確認を行ったバージョンは次の通り．

	個別パッケージの名称	バージョン	個別パッケージファイル名
	------------------------------------------------------------------
	ターゲット非依存部		3.3.1		asp3-3.3.1.tar.gz

1.4 開発環境と動作確認条件

開発環境として，Xilinx社のSDKに付属のコンパイラとIDEを用いる．

	https://japan.xilinx.com/products/design-tools/embedded-software/sdk.html

動作確認を行ったバージョンは次の通り．

  - Xilinx SDK 2017.4

make によりビルドする場合は，以下のオプションでconfigureを実行すること． 

 configure.rb -T zynq7000_gcc -S "syslog.o banner.o serial.o target_serial.o logtask.o"
 
1.5 メモリマップ

メモリマップはボード毎に異なる．メモリマップを変更する場合には，
Makefile.targetとzynq7000.hを修正する必要がある．

２．ターゲット定義事項の規定

Zynq-7000ターゲット依存部は，ARMコア依存部とMPCoreチップ依存部を用いて
実装されている．ARMコア依存部およびMPCoreチップ依存部におけるターゲッ
ト定義事項の規定については，「ARM依存部 ユーザーズマニュアル」を参照す
ること．

以下では，ARMコア依存部およびMPCoreチップ依存部と異なる，ないしは，それ
らで規定されていない事項について説明する．

2.1 割込み優先度と割込み番号

Zynq-7000の割込みコントローラ（Distributed Interrupt Controller）は，
32レベルの割込み優先度をサポートしている．そのため，割込み優先度の最小
値（最高値）は-31，割込み優先度の最大値（最低値）は-1である．

2.2 オーバランハンドラ機能拡張のサポートに関する規定

オーバランハンドラ機能拡張パッケージをサポートしている．

３．ドライバ関連の情報

3.1 タイマドライバ

高分解能タイマは，MPCoreがコア毎に持つプライベートタイマとプライベート
ウォッチドッグを使用して実現している．具体的には，ウォッチドッグを現在
時刻の管理のために用い，タイマを相対時間割込みの発生のために用いている．
そのため，これらのタイマを別の目的で使用することはできない．

また，オーバランハンドラ機能をサポートする場合には，TTCを用いている．

3.2 シリアルインタフェースドライバ

シリアルインタフェースドライバでは，XUARTPSの内の1つを用いて，SIOポー
トを1つのみサポートしている．

用いるSIOポートを変更する場合には，tSIOPortZynq7000.cdlを修正する必要
がある．

3.3 システムログの低レベル出力

システムログの低レベル出力は，シリアルインタフェースドライバが用いてい
るのと同じUARTを用い，ポーリングにより文字を出力する方法で実現している．

用いるSIOポートを変更する場合には，target.cdlを修正する必要がある．


４．システム構築手順と実行手順

4.1 システム構築

Zynq-7000用のASP3カーネルを構築する手順は，「TOPPERS/ASP3カーネル ユー
ザーズマニュアル」の「３．クイックスタートガイド」の章に記述されている
通りである．

Xilinx SDKでビルドする場合は，ワークスペースを作成し，以下の各フォルダ
にあるプロジェクトをインポートすることで，サンプルプログラムがビルド可
能である．

Zybo     : arduzynq_sdk
Arduzynq : zybo_sdk

５．リファレンス

5.1 ディレクトリ構成・ファイル構成

	target/zynq7000_gcc/
		E_PACKAGE				簡易パッケージのファイルリスト
		MANIFEST				個別パッケージのファイルリスト
		Makefile.target			Makefileのターゲット依存部
		target_cfg1_out.h		cfg1_out.cのリンクに必要なスタブの定義
		target_check.trb		kernel_check.trbのターゲット依存部
		target_kernel.cfg		カーネル実装のコンフィギュレーションファイル
		target_kernel.h			kernel.hのターゲット依存部
		target_kernel.trb		kernel.trbのターゲット依存部
		target_kernel_impl.c	カーネル実装のターゲット依存部
		target_kernel_impl.h	カーネル実装のターゲット依存部に関する定義
		target_rename.def		ターゲット依存部の内部識別名のリネーム定義
		target_rename.h			ターゲット依存部の内部識別名のリネーム
		target_sil.h			sil.hのターゲット依存部
		target_stddef.h			t_stddef.hのターゲット依存部
		target_syssvc.h			システムサービスのターゲット依存定義
		target_test.h			テストプログラムのターゲット依存定義
		target_timer.c			タイマドライバ
		target_timer.cfg		タイマドライバのコンフィギュレーションファイル
		target_timer.h			タイマドライバを使用するための定義
		target_unrename.h		ターゲット依存部の内部識別名のリネーム解除
		target_user.txt			ターゲット依存部のユーザーズマニュアル
		tPutLogZynq7000.c		システムログの低レベル出力
		tPutLogZynq7000.cdl		システムログの低レベル出力のコンポーネント記述
		tSIOPortZynq7000.cdl	シリアルインタフェースドライバのターゲット
								依存部（Zynq7000用）のコンポーネント記述
		tSIOPortZynq7000Main_inline.h		シリアルインタフェースドライバ
								のターゲット依存部（Zynq7000用）
		xUartPs.c				xuartps用のドライバ
		xUartPs.cdl				xuartps用のコンポーネント記述
		xuartps.h				XUART用のレジスタ定義
		zynq7000.h				ターゲットのハードウェア資源の定義
		zynq7000.ld				標準のリンカスクリプト
		zybo_sdk				ZYBO用のXilinx SDKプロジェクト
		arduzynq_sdk			Arduzynq用のXilinx SDKプロジェクト

5.2 バージョン履歴

・2018/5/02
  ・3.3.1対応
・2017/7/26
  ・最初のリリース
  
 
以上
